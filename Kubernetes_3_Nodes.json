{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description" : "Template para crear 3 EC2, un master y 2 minions con la idea de usar Kubernetes",
    
    "Mappings" : {

        "sg01" : {
          "basico" : {
            "nombre" : "sg_kubernetes01",
            "desc"   : "Habilita puerto 22"
          },
             
          "ingress": {"proto" : "tcp", "from" : "22" , "to" : "22" , "rango" : "0.0.0.0/0"}
        },
        "sg02" : {
          "basico" : {
            "nombre" : "sg_kubernetes02",
            "desc"   : "Habilita puerto 22"
          },
             
          "ingress": {"proto" : "tcp", "from" : "22" , "to" : "22" , "rango" : "0.0.0.0/0"}
        }
    },

    "Resources" : {

            "InstanceSecurityGroup01" : {
              "Type" : "AWS::EC2::SecurityGroup",
              "Properties" : {
                  "GroupName" : { "Fn::FindInMap" : [ "sg01", "basico", "nombre"] },
                  "GroupDescription" : { "Fn::FindInMap" : [ "sg01", "basico", "desc"] },
                  "SecurityGroupIngress" : [ {
                    "IpProtocol" : { "Fn::FindInMap" : [ "sg01", "ingress", "proto" ]},
                    "FromPort" : { "Fn::FindInMap" : [ "sg01", "ingress", "from" ]},
                    "ToPort" : { "Fn::FindInMap" : [ "sg01", "ingress", "to" ]},
                    "CidrIp" : { "Fn::FindInMap" : [ "sg01", "ingress", "rango" ] }
                  } ]
              }
            },

            "InstanceSecurityGroup02" : {
              "Type" : "AWS::EC2::SecurityGroup",
              "Properties" : {
                  "GroupName" : { "Fn::FindInMap" : [ "sg02", "basico", "nombre"] },
                  "GroupDescription" : { "Fn::FindInMap" : [ "sg02", "basico", "desc"] },
                  "SecurityGroupIngress" : [ {
                    "IpProtocol" : { "Fn::FindInMap" : [ "sg02", "ingress", "proto" ]},
                    "FromPort" : { "Fn::FindInMap" : [ "sg02", "ingress", "from" ]},
                    "ToPort" : { "Fn::FindInMap" : [ "sg02", "ingress", "to" ]},
                    "CidrIp" : { "Fn::FindInMap" : [ "sg02", "ingress", "rango" ] }
                  } ]
              }
            }
    },

    "Outputs" : {
      "sgI01" : {
        "Description" : "Sg creado ",
        "Value" :  { "Fn::Join" : [ "--", [ "Id del security group", { "Fn::GetAtt" : [ "InstanceSecurityGroup01", "GroupId" ]}]]}
      },
      "FromPortToPortsg01" : {
        "Description" : "Rango de puertos abiertos de entrada definidos ",
        "Value" :  { "Fn::Join" : [ "--", [ { "Fn::FindInMap" : [ "sg01", "ingress", "from" ]}, { "Fn::FindInMap" : [ "sg01", "ingress", "to" ]}]]}
      },
      "sgIG02" : {
        "Description" : "Sg creado ",
        "Value" :  { "Fn::Join" : [ "--", [ "Id del security group", { "Fn::GetAtt" : [ "InstanceSecurityGroup02", "GroupId" ]}]]}
      },
      "FromPortToPortsg02" : {
        "Description" : "Rango de puertos abiertos de entrada definidos ",
        "Value" :  { "Fn::Join" : [ "--", [ { "Fn::FindInMap" : [ "sg02", "ingress", "from" ]}, { "Fn::FindInMap" : [ "sg02", "ingress", "to" ]}]]}
      }
    }
 
}